# 店舗DX - 新商品配布設定変換システム

店舗在庫管理システム『店舗DX』の新商品配布設定を変換するJavaScriptシステムです。

## 📋 概要

Excelファイルから3種類のCSVファイルを自動生成します:
- **変換A.csv**: ディスプレイ数あり(配布数の半数・切り上げ)
- **変換B-1.csv**: ディスプレイ数なし
- **変換B-2.csv**: ロジザード用(見出しなし)

## 🚀 使い方

### 1. ファイルの配置
`index.html` をGitHubリポジトリに配置します。

### 2. GitHub Pagesの設定(推奨)
1. GitHubリポジトリの Settings > Pages に移動
2. Source を "Deploy from a branch" に設定
3. Branch を main または master に設定
4. Save をクリック
5. 数分後に公開URLが表示されます

### 3. 使用方法
1. ブラウザで `index.html` を開く
2. **店舗マスタを設定**
   - デフォルトで16店舗が設定済み
   - 形式: `店舗コード,店舗名,出荷曜日`
   - 例: `0089,西宮,金`
3. **Excelファイルをドラッグ&ドロップ**または選択
4. **ダウンロード方法を選択**
   - 📦 **ZIPファイル**: 3つのCSVをまとめてダウンロード（推奨）
   - 📄 **個別ダウンロード**: Windowsセキュリティブロックを回避

### 4. 💡 Windowsセキュリティブロックについて
ZIPファイルをダウンロードした場合、Windowsがセキュリティのため CSVファイルをブロックすることがあります。

#### 解決方法（2つ）
**方法1: 個別ダウンロードを使用**（最も簡単）
- 変換完了後、「個別ダウンロード」ボタンを選択
- 3つのCSVファイルが別々にダウンロードされ、ブロックされません

**方法2: ZIPファイルのブロックを解除**
1. ダウンロードしたZIPファイルを右クリック
2. 「プロパティ」を選択
3. 「セキュリティ」の「許可する」にチェック
4. 「OK」をクリック
5. ZIPファイルを解凍

詳細は `Windowsセキュリティブロック解除方法.md` を参照してください。

## 📊 入力データ形式

### Excelファイルの構造
- **5行目**: 品番が格納されている
- **14行目以降**: 店舗データ
  - 列B (2列目): 店舗コード
  - 列C (3列目): 店舗名
  - 列E以降 (5列目〜): 各品番の配布数

## 📤 出力データ形式

### 変換A
```csv
店舗コード,店舗名称,型番,品番,商品コード,商品名称,型番,入数,手持ち日数,ディスプレイ数,上限値,売上ランク,センター在庫,店舗在庫,廃盤,大分類,中分類,小分類,細分類,発注締め日,発注バラ数,タグ1,タグ2,タグ3,タグ4,タグ5,タグ6,タグ7,タグ8
0089,,,7907073,,,,,7,1,2,,,,,,,,,,2,,,,,,,,
```

### 変換B-1
```csv
店舗コード,店舗名称,型番,品番,商品コード,商品名称,型番,入数,手持ち日数,ディスプレイ数,上限値,売上ランク,センター在庫,店舗在庫,廃盤,大分類,中分類,小分類,細分類,発注締め日,発注バラ数,タグ1,タグ2,タグ3,タグ4,タグ5,タグ6,タグ7,タグ8
0089,,,7907073,,,,,7,,,,,,,,,,,,,,,,,,,,
```

### 変換B-2(見出しなし)
```csv
0901,0089,20251128,20251129,131313,1,7907073,2,1
```

フォーマット:
- 出荷元: 0901(固定)
- 出荷先: 店舗コード
- 出荷日: マスタの出荷曜日から計算(yyyymmdd)
- 納品日: 出荷日+1日(yyyymmdd)
- 出荷時間: 131313(固定)
- 棚版: 1(固定)
- 品番
- 出荷数: 配布数
- チェック用: 1(固定)

## ⚙️ 変換ルール

### 手持ち日数
- 全て **7** 固定

### ディスプレイ数(変換A)
- 配布数の半数(端数切り上げ)
- 例: 配布数5 → ディスプレイ数3

### 上限値(変換A)
- 配布数と同じ

### 発注バラ数
- 配布数と同じ

### 出荷日(変換B-2)
- 店舗マスタの出荷曜日を参照
- 本日から最短の該当曜日を算出

## 📦 ファイル出力

### ZIPファイルダウンロードの場合
ファイル名: `店舗DX_変換_yyyymmddHHMM.zip`

ZIPファイルの構造:
```
202411251430/
  ├── 変換A.csv
  ├── 変換B-1.csv
  └── 変換B-2.csv
```

### 個別ダウンロードの場合
3つのファイルが別々にダウンロードされます:
- `変換A_202411251430.csv`
- `変換B-1_202411251430.csv`
- `変換B-2_202411251430.csv`

## 🔧 技術仕様

### 使用ライブラリ
- **SheetJS (XLSX)**: Excelファイルの読み込み
- **JSZip**: ZIPファイルの生成

### 文字コード
- 変換A・B-1: UTF-8 with BOM
- 変換B-2: UTF-8 (BOMなし)

### ブラウザ対応
- Chrome / Edge: 最新版
- Firefox: 最新版
- Safari: 最新版

## 📝 店舗マスタ設定

### 形式
```
店舗コード,店舗名,出荷曜日
```

### 曜日の指定
- 日、月、火、水、木、金、土

### デフォルト設定
```
0089,西宮,金
0171,イオン伊丹,金
0026,ＬＴ,水
0024,流山,火
0112,吉祥寺,水
0077,高槻,水
0023,ＮＰ,火
0094,ららぽーと豊洲,火
0005,川崎ルフロン,水
0022,箱崎,水
0017,相模大野,水
0048,青葉台東急,火
0100,グランデュオ蒲田,水
0081,池袋ＨＣ,火
0014,新横浜ペペ,火
0076,仙台泉,水
```

## ⚠️ 注意事項

1. **店舗マスタは必須です**
   - 変換B-2の出荷日計算に使用されます
   - マスタに存在しない店舗コードのデータは変換B-2に出力されません

2. **Excelファイルの構造**
   - 5行目に品番が配置されている必要があります
   - 14行目からデータが開始されている必要があります

3. **配布数**
   - 数値以外または0の場合は変換されません
   - 空白セルも変換対象外です

4. **件数制限**
   - 変換A・B-1: 1,000行まで(システム制限ではなく運用上の制限)
   - 変換B-2: 制限なし

## 🐛 トラブルシューティング

### エラー: "店舗マスタを設定してください"
→ 店舗マスタのテキストエリアが空欄です。店舗情報を入力してください。

### エラー: "Excelファイルを選択してください"
→ .xlsx または .xls 形式のファイルを選択してください。

### 変換B-2にデータが出力されない
→ 該当店舗コードが店舗マスタに登録されているか確認してください。

### CSVファイルが開けない（Windowsセキュリティブロック）
→ 「個別ダウンロード」を選択するか、`Windowsセキュリティブロック解除方法.md` を参照してください。

### ブラウザでポップアップがブロックされる
→ ブラウザのアドレスバー右側のアイコンをクリックし、ポップアップを許可してください。

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 🤝 サポート

問題が発生した場合は、GitHubのIssuesにて報告してください。
